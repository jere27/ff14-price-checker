<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>FF14 HQã‚¢ã‚¤ãƒ†ãƒ ä¾¡æ ¼ãƒã‚§ãƒƒã‚«ãƒ¼</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 650px;
    }
    select, button {
      padding: 8px;
      font-size: 14px;
      margin-right: 5px;
    }
    ul {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h1>FF14 HQã‚¢ã‚¤ãƒ†ãƒ ä¾¡æ ¼ãƒã‚§ãƒƒã‚¯</h1>

  <!-- DCé¸æŠ -->
  <label>
    DCï¼š
    <select id="dc-select">
      <option value="Mana">Mana</option>
      <option value="Gaia">Gaia</option>
      <option value="Elemental">Elemental</option>
      <option value="Meteor">Meteor</option>
    </select>
  </label>

  <br><br>

  <!-- ã‚¢ã‚¤ãƒ†ãƒ é¸æŠ -->
  <label>
    ã‚¢ã‚¤ãƒ†ãƒ ï¼š
    <select id="item-select"></select>
  </label>

  <button onclick="fetchPrice()">ä¾¡æ ¼å–å¾—ï¼ˆHQã®ã¿ï¼‰</button>

  <h2 id="average"></h2>
  <ul id="list"></ul>

  <script>
    // ===== ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§ =====
    const ITEMS = [
      { id: 49228, name: "ã‚¤ãƒ¨ãƒ©ã‚¨ã‚­ã‚¹" },
      { id: 44051, name: "ï¼ˆID:44051 ã®ã‚¢ã‚¤ãƒ†ãƒ ï¼‰" }
    ];

    // åˆæœŸåŒ–
    function initItems() {
      const select = document.getElementById("item-select");
      ITEMS.forEach(item => {
        const option = document.createElement("option");
        option.value = item.id;
        option.textContent = item.name;
        select.appendChild(option);
      });
    }

    async function fetchPrice() {
      try {
        const itemId = document.getElementById("item-select").value;
        const dc = document.getElementById("dc-select").value;

        const url = `https://universalis.app/api/v2/${dc}/${itemId}`;
        const res = await fetch(url);

        if (!res.ok) {
          throw new Error("APIå–å¾—å¤±æ•—");
        }

        const data = await res.json();

        if (!data.listings || data.listings.length === 0) {
          alert("å‡ºå“ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");
          return;
        }

        // ğŸ”½ HQã®ã¿æŠ½å‡º
        const hqOnly = data.listings.filter(item => item.hq === true);

        if (hqOnly.length === 0) {
          alert("HQå‡ºå“ãŒã‚ã‚Šã¾ã›ã‚“");
          return;
        }

        // å®‰ã„é †ã«10ä»¶
        const sorted = hqOnly
          .sort((a, b) => a.pricePerUnit - b.pricePerUnit)
          .slice(0, 10);

        // å¹³å‡å€¤
        const total = sorted.reduce((sum, i) => sum + i.pricePerUnit, 0);
        const average = Math.round(total / sorted.length);

        // è¡¨ç¤º
        document.getElementById("list").innerHTML =
          sorted.map(i =>
            `<li>
              ${i.pricePerUnit.toLocaleString()} ã‚®ãƒ«
              ï¼ˆ${i.worldName} / HQï¼‰
            </li>`
          ).join("");

        document.getElementById("average").textContent =
          `HQå®‰å€¤${sorted.length}ä»¶ã®å¹³å‡ä¾¡æ ¼ï¼š${average.toLocaleString()} ã‚®ãƒ«`;

      } catch (e) {
        console.error(e);
        alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚Consoleã‚’ç¢ºèªã—ã¦ãã ã•ã„");
      }
    }

    window.onload = initItems;
  </script>

</body>
</html>
