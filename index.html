<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>FF14 価格チェッカー</title>
</head>
<body>
  <h1>イヨラエキス 価格チェック</h1>
  <button onclick="fetchPrice()">価格取得</button>
  <h2 id="average"></h2>
  <ul id="list"></ul>

<script>
  const ITEM_ID = 49228;
  const DC_NAME = "Mana"; // Gaia / Mana / Elemental / Meteor など

  async function fetchPrice() {
    try {
      const url = `https://universalis.app/api/v2/markets/${ITEM_ID}?dc=${DC_NAME}`;
      const res = await fetch(url);

      if (!res.ok) {
        throw new Error("API取得失敗");
      }

      const data = await res.json();

      if (!data.listings || data.listings.length === 0) {
        alert("出品データがありません");
        return;
      }

      const sorted = data.listings
        .sort((a, b) => a.pricePerUnit - b.pricePerUnit)
        .slice(0, 10);

      const total = sorted.reduce((sum, i) => sum + i.pricePerUnit, 0);
      const average = Math.round(total / sorted.length);

      document.getElementById("list").innerHTML =
        sorted.map(i =>
          `<li>${i.pricePerUnit.toLocaleString()} ギル（${i.worldName}）</li>`
        ).join("");

      document.getElementById("average").textContent =
        `安値10件の平均価格（${DC_NAME}）：${average.toLocaleString()} ギル`;

    } catch (e) {
      console.error(e);
      alert("エラーが発生しました。Consoleを確認してください");
    }
  }
</script>

</body>
</html>
